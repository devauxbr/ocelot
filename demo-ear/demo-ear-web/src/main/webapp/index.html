<!DOCTYPE html>
<html>
	<head>
		<title>Page de test</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="ocelot.js" type="text/javascript"></script>
		<script src="status.js" type="text/javascript"></script>
	</head>
	<body>
		<script>
			var pojoService = new TestPojoService();
			var ejbService = new TestEJBService();
			function getMessage(srv) {
				srv.getMessage(Math.floor(Math.random() * 10)).then(addMessage).catch(fail);
			}
			function getMessageCached(srv) {
				srv.getMessageCached().then(addMessage).catch(fail);
			}
			function getMessage2(srv) {
				srv.getMessage("" + Math.floor(Math.random() * 10)).then(addMessage).catch(fail);
			}
			function fail(fault) {
				alert(fault.message + "\n" + fault.classname + "\n" + fault.stacktrace.join('\n'));
			}
			function addMessage(msg) {
				var output = document.getElementById("output");
				var pre = document.createElement("p");
				pre.style.wordWrap = "break-word";
				pre.innerHTML = msg;
				output.appendChild(pre);
			}
			var mdb;
			function subscribe() {
				mdb = new Subscriber("mytopic").message(addMessage);
			}
			function unsubscribe(msg) {
				if(mdb) mdb.unsubscribe();
			}

			function showObject() {
				var obj = eval(document.getElementById("testobject").value);
				document.getElementById("objectarea").textContent = JSON.stringify(obj).replace(/,/g, ",\n");
			}
		</script>
		<svg width="126" height="20">
			<linearGradient id="b" x2="0" y2="100%">
				<stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
				<stop offset="1" stop-opacity=".1"/>
			</linearGradient>
			<mask id="a">
				<rect width="126" height="20" rx="3" fill="#fff"/>
			</mask>
			<g mask="url(#a)">
				<path fill="#555" d="M0 0h74v20H0z"/>
				<path id="status-color" fill="#9f9f9f" d="M74 0h52v20H74z"/>
				<path fill="url(#b)" d="M0 0h126v20H0z"/>
			</g>
			<g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11">
				<text x="37" y="15" fill="#010101" fill-opacity=".3">WebSocket</text>
				<text x="37" y="14">WebSocket</text>
				<text id="status-text-shadow" x="96" y="15" fill="#010101" fill-opacity=".3"></text>
				<text id="status-text" x="96" y="14"></text>
			</g>						
		</svg>
		<input id="testobject" type="text" value="document.location"/>
		<button onclick="showObject()">SHOW OBJECT</button><br>
		<textarea style="height:200px;width:100%" id="objectarea"></textarea><br>
		<button onclick="subscribe();">SUBSCRIBE</button>
		<button onclick="unsubscribe();">UNSUBSCRIBE</button>
		<button onclick="getMessage(ejbService)">GET EJB MESSAGE(int)</button>
		<button onclick="getMessage2(ejbService)">GET EJB MESSAGE(str)</button>
		<button onclick="getMessageCached(ejbService)">GET EJB MESSAGE CACHED 1Mn</button>
		<button onclick="getMessage(pojoService)">GET POJO MESSAGE(int)</button>
		<button onclick="getMessage2(pojoService)">GET POJO MESSAGE(str)</button>
		<button onclick="ocelotController.close()">CLOSE WS</button>
		<div id="output"></div>
	</body>
</html>
