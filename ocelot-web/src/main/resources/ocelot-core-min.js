var ocelotController,OcelotPromiseFactory,MD5Tools,Subscriber=function(e){var o=ocelotServices.subscribe(e);return Object.defineProperty(o,"topic",{get:function(){return e}}),o.unsubscribe=function(){return ocelotServices.unsubscribe(e)},o};"WebSocket"in window?(ocelotController=function(){function e(e,o,t){var n=document.createEvent(N);return n.initEvent(e,!0,!1),n.dataservice=o.dataservice,n.operation=o.operation,n.args=o.args,n.totaltime=0,n.javatime=0,n.jstime=0,n.networktime=0,t&&(n.response=t.response,y.monitor&&(n.javatime=t.t)),y.monitor&&(n.totaltime=(new Date).getTime()-o.t),n}function o(o,t){return e(E,o,t)}function t(o,t){return e(O,o,t)}function n(o,t){return e(b,o,t)}function r(o,t){return e(L,o,t)}function s(){c(x,function(e){var t=o(e,{response:ocelotController.status,t:0});e.response=t})}function c(e,o){i(u(e),o)}function i(e,o){var t;if(e)for(t=0;t<e.length;t++)o(e[t])}function a(e,o){var t=void 0!==A[o];return t||(A[o]=[]),A[o].push(e),t}function l(e){delete A[e]}function u(e){return A[e]||[]}function f(e){return"ocelotController"===e.dataservice?!0:!1}function h(e){return e.dataservice===P&&e.operation===R}function d(e,o){return h(e)&&T(e,o)}function g(e){return e.dataservice===P&&e.operation===J}function p(e,o){return g(e)&&T(e,o)}function T(e,o){return o?e.args[0]===o:!0}function M(e){var o=e.split("&");o.forEach(function(e){if(0===e.search(/^\??ocelot=/)){var o=decodeURI(e.replace(/\??ocelot=/,""));y=JSON.parse(o)}})}function v(e){var o,t,n=JSON.stringify(e.json);a(e,e.id)||(h(e)||g(e)?1===C.readyState?C.send(n):e.response=r(e,{response:{classname:"Websocket",message:"Websocket is not ready : status = "+status,stacktrace:[]},t:0}):(t=new XMLHttpRequest,t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(o=JSON.parse(t.responseText),D(o)):e.response=r(e,{response:{classname:"XMLHttpRequest",message:"XMLHttpRequest request failed : code = "+t.status,stacktrace:[]},t:0}))},t.open("POST","http"+S+"ocelot/endpoint?monitor="+y.monitor,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("mfc="+n)))}function D(e){var s,c,e,i,f=u(e.id);for(e.type===O&&ocelotController.cacheManager.putResultInCache(e),s=0;s<f.length;s++)i=f[s],e.type===L?c=r(i,e):e.type===O?(d(i)?a(i,i.args[0]):p(i)&&l(i.args[0]),c=t(i,e)):e.type===b?c=n(i,e):e.type===E&&(c=o(i,e)),i.response=c;e.type!==E&&l(e.id)}function m(){console.info("Websocket initialization...");for(var e=0;e<document.scripts.length;e++){var o=document.scripts[e];-1!==o.src.indexOf("ocelot.js")?S=o.src.replace(/^http/,"").replace(/ocelot\.js.*/,""):-1!==o.src.indexOf("ocelot/core.js")?S=o.src.replace(/^http/,"").replace(/ocelot\/core\.js.*/,""):-1!==o.src.indexOf("ocelot/core.min.js")&&(S=o.src.replace(/^http/,"").replace(/ocelot\/core\.min\.js.*/,""))}M(document.location.search),C=new WebSocket("ws"+S+"ocelot-endpoint"),C.onmessage=function(e){D(JSON.parse(e.data))},C.onopen=function(e){console.info("Websocket opened");var o,n,r,c,a;if(s(),n=u("ocelotController.open"),n.length){for(r=0;r<n.length;r++)a=n[r],a.response=t(a,{response:null,t:0});return c=A,A={},Object.keys(c).forEach(function(e){e!==c[e].id&&i(c[e],ocelotController.addPromise)}),void l("ocelotController.open")}for(ocelotServices.subscribe(k).message(function(e){e===I?ocelotController.cacheManager.clearCache():ocelotController.cacheManager.removeEntryInCache(e)}),ocelotServices.getLocale().then(function(e){e&&ocelotServices.setLocale(e)}),ocelotServices.getOutDatedCache(ocelotController.cacheManager.getLastUpdateCache()).then(function(e){ocelotController.cacheManager.removeEntries(e)});o=W.shift();)o()},C.onerror=function(e){console.info("Websocket error : "+e.reason),F.forEach(function(o){o(e)}),s()},C.onclose=function(e){var o,n,r=u("ocelotController.close");if(r.length){for(n=0;n<r.length;n++)o=r[n],o.response=t(o,{response:e.reason,t:0});l("ocelotController.close")}_.forEach(function(o){o(e)}),s(),console.info("Websocket closed : "+e.reason)}}var S,C,y={monitor:!1,debug:!1},E="MESSAGE",b="CONSTRAINT",O="RESULT",L="FAULT",I="ALL",N="Event",w="add",j="remove",k="ocelot-cleancache",x="ocelot-status",P="org.ocelotds.OcelotServices",R="subscribe",J="unsubscribe",U=["CONNECTING","OPEN","CLOSING","CLOSED"],A={},W=[],_=[],F=[];return m(),{get options(){return y},get status(){return U[C.readyState]},addOpenListener:function(e){1===C.readyState?e():W.push(e)},addCloseListener:function(e){3===C.readyState?e():_.push(e)},addErrorListener:function(e){F.push(e)},open:function(){var e=OcelotPromiseFactory.createPromise("ocelotController","ocelotController.open","open",[],[]);return m(),e},close:function(e){var o=OcelotPromiseFactory.createPromise("ocelotController","ocelotController.close","close",[],[]);return setTimeout(function(){C.close(1e3,"Normal closure; the connection successfully completed whatever purpose for which it was created."|e)},10),o},addPromise:function(e){if(d(e,x))return a(e,x),void s();if(p(e,x))return void l(x);if(f(e))return void a(e,e.id);var o=ocelotController.cacheManager.getResultInCache(e.id,e.cacheIgnored);return o?void(e.response=t(e,{response:o.response,t:0})):void v(e)},cacheManager:function(){function e(e){var o=document.createEvent(N);o.initEvent(w,!0,!1),o.msg=e,r.forEach(function(e){e(o)})}function o(e){var o=document.createEvent(N);o.initEvent(j,!0,!1),o.key=e,s.forEach(function(e){e(o)})}var t,n="ocelot-lastupdate",r=[],s=[];return t={addEntry:function(e){var o=this.getLastUpdateCache();o[e]=Date.now(),localStorage.setItem(n,JSON.stringify(o))},removeEntry:function(e){var o=this.getLastUpdateCache();delete o[e],localStorage.setItem(n,JSON.stringify(o))},getLastUpdateCache:function(){var e=localStorage.getItem(n);return e=e?JSON.parse(e):{}}},{getLastUpdateCache:function(){return t.getLastUpdateCache()},addEventListener:function(e,o){e===w?r.push(o):e===j&&s.push(o)},removeEventListener:function(e,o){var t=-1;e===w?(t=r.indexOf(o),-1!==t&&r.splice(t,1)):e===j&&(t=s.indexOf(o),-1!==t&&s.splice(t,1))},putResultInCache:function(o){if(o.deadline){var n,r,s;t.addEntry(o.id),e(o),n=o.id.split("_"),r=localStorage.getItem(n[0]),s={},r&&(s=JSON.parse(r)),s[n[1]]=o,r=JSON.stringify(s),localStorage.setItem(n[0],r)}},getResultInCache:function(e,o){var t,n,r,s,c;return o?null:(t=e.split("_"),r=null,n=localStorage.getItem(t[0]),n&&(s=JSON.parse(n),r=s[t[1]]),r&&(c=(new Date).getTime(),c>r.deadline&&(this.removeEntryInCache(e),r=null)),r)},removeEntryInCache:function(e){var n,r,s;t.removeEntry(e),o(e),n=e.split("_"),r=localStorage.getItem(n[0]),r&&(s=JSON.parse(r),2===n.length?(delete s[n[1]],localStorage.setItem(n[0],JSON.stringify(s))):localStorage.removeItem(n[0]))},removeEntries:function(e){e.forEach(function(e){removeEntryInCache(e)})},clearCache:function(){localStorage.clear()}}}()}}(),OcelotPromiseFactory=function(){var e="MESSAGE",o="RESULT",t="FAULT",n="CONSTRAINT";return{createPromise:function(r,s,c,i,a){return function(r,s,c,i,a){function l(){if(h)if(h.type!==e){for(;f=T.shift();)f(h);if(h.type===o)for(;f=d.shift();)f(h.response);else if(h.type===n)for(;f=p.shift();)f(h.response);else if(h.type===t)for(u=h.response,console.error(u.classname+"("+u.message+")"),console.table(u.stacktrace);f=g.shift();)f(u)}else M.forEach(function(e){e(h.response)})}var u,f,h=null,d=[],g=[],p=[],T=[],M=[],v={id:s,key:s,dataservice:r,operation:c,args:a,argNames:i,cacheIgnored:!1,t:(new Date).getTime(),set response(e){h=e,l()},ignoreCache:function(e){return this.cacheIgnored=e,this},then:function(e,o){return e&&d.push(e),o&&g.push(o),l(),this},"catch":function(e){return e&&g.push(e),l(),this},constraint:function(e){return e&&p.push(e),l(),this},event:function(e){return e&&T.push(e),l(),this},message:function(e){return e&&M.push(e),l(),this},get json(){return{id:this.id,ds:this.dataservice,op:this.operation,argNames:this.argNames,args:this.args}}},D=document.createEvent("Event");return D.initEvent("call",!0,!1),D.promise=v,setTimeout(function(){document.dispatchEvent(D)},1),v}(r,s,c,i,a)}}}(),document.addEventListener("call",function(e){ocelotController.addPromise(e.promise)}),window.addEventListener("beforeunload",function(e){ocelotController&&ocelotController.close()}),MD5Tools=function(){return{hex_chr:function(e){return"0123456789abcdef".charAt(e)},rhex:function(e){var o,t="";for(o=0;3>=o;o++)t+=this.hex_chr(e>>8*o+4&15)+this.hex_chr(e>>8*o&15);return t},str2blks_MD5:function(e){var o,t,n=(e.length+8>>6)+1;for(o=new Array(16*n),t=0;16*n>t;t++)o[t]=0;for(t=0;t<e.length;t++)o[t>>2]|=e.charCodeAt(t)<<t%4*8;return o[t>>2]|=128<<t%4*8,o[16*n-2]=8*e.length,o},add:function(e,o){var t,n;return t=(65535&e)+(65535&o),n=(e>>16)+(o>>16)+(t>>16),n<<16|65535&t},rol:function(e,o){return e<<o|e>>>32-o},cmn:function(e,o,t,n,r,s){return this.add(this.rol(this.add(this.add(o,e),this.add(n,s)),r),t)},ff:function(e,o,t,n,r,s,c){return this.cmn(o&t|~o&n,e,o,r,s,c)},gg:function(e,o,t,n,r,s,c){return this.cmn(o&n|t&~n,e,o,r,s,c)},hh:function(e,o,t,n,r,s,c){return this.cmn(o^t^n,e,o,r,s,c)},ii:function(e,o,t,n,r,s,c){return this.cmn(t^(o|~n),e,o,r,s,c)}}}(),String.prototype.md5=function(){var e,o,t,n,r,s,c,i,a,l;for(e=MD5Tools.str2blks_MD5(this),o=1732584193,t=-271733879,n=-1732584194,r=271733878,l=0;l<e.length;l+=16)s=o,c=t,i=n,a=r,o=MD5Tools.ff(o,t,n,r,e[l+0],7,-680876936),r=MD5Tools.ff(r,o,t,n,e[l+1],12,-389564586),n=MD5Tools.ff(n,r,o,t,e[l+2],17,606105819),t=MD5Tools.ff(t,n,r,o,e[l+3],22,-1044525330),o=MD5Tools.ff(o,t,n,r,e[l+4],7,-176418897),r=MD5Tools.ff(r,o,t,n,e[l+5],12,1200080426),n=MD5Tools.ff(n,r,o,t,e[l+6],17,-1473231341),t=MD5Tools.ff(t,n,r,o,e[l+7],22,-45705983),o=MD5Tools.ff(o,t,n,r,e[l+8],7,1770035416),r=MD5Tools.ff(r,o,t,n,e[l+9],12,-1958414417),n=MD5Tools.ff(n,r,o,t,e[l+10],17,-42063),t=MD5Tools.ff(t,n,r,o,e[l+11],22,-1990404162),o=MD5Tools.ff(o,t,n,r,e[l+12],7,1804603682),r=MD5Tools.ff(r,o,t,n,e[l+13],12,-40341101),n=MD5Tools.ff(n,r,o,t,e[l+14],17,-1502002290),t=MD5Tools.ff(t,n,r,o,e[l+15],22,1236535329),o=MD5Tools.gg(o,t,n,r,e[l+1],5,-165796510),r=MD5Tools.gg(r,o,t,n,e[l+6],9,-1069501632),n=MD5Tools.gg(n,r,o,t,e[l+11],14,643717713),t=MD5Tools.gg(t,n,r,o,e[l+0],20,-373897302),o=MD5Tools.gg(o,t,n,r,e[l+5],5,-701558691),r=MD5Tools.gg(r,o,t,n,e[l+10],9,38016083),n=MD5Tools.gg(n,r,o,t,e[l+15],14,-660478335),t=MD5Tools.gg(t,n,r,o,e[l+4],20,-405537848),o=MD5Tools.gg(o,t,n,r,e[l+9],5,568446438),r=MD5Tools.gg(r,o,t,n,e[l+14],9,-1019803690),n=MD5Tools.gg(n,r,o,t,e[l+3],14,-187363961),t=MD5Tools.gg(t,n,r,o,e[l+8],20,1163531501),o=MD5Tools.gg(o,t,n,r,e[l+13],5,-1444681467),r=MD5Tools.gg(r,o,t,n,e[l+2],9,-51403784),n=MD5Tools.gg(n,r,o,t,e[l+7],14,1735328473),t=MD5Tools.gg(t,n,r,o,e[l+12],20,-1926607734),o=MD5Tools.hh(o,t,n,r,e[l+5],4,-378558),r=MD5Tools.hh(r,o,t,n,e[l+8],11,-2022574463),n=MD5Tools.hh(n,r,o,t,e[l+11],16,1839030562),t=MD5Tools.hh(t,n,r,o,e[l+14],23,-35309556),o=MD5Tools.hh(o,t,n,r,e[l+1],4,-1530992060),r=MD5Tools.hh(r,o,t,n,e[l+4],11,1272893353),n=MD5Tools.hh(n,r,o,t,e[l+7],16,-155497632),t=MD5Tools.hh(t,n,r,o,e[l+10],23,-1094730640),o=MD5Tools.hh(o,t,n,r,e[l+13],4,681279174),r=MD5Tools.hh(r,o,t,n,e[l+0],11,-358537222),n=MD5Tools.hh(n,r,o,t,e[l+3],16,-722521979),t=MD5Tools.hh(t,n,r,o,e[l+6],23,76029189),o=MD5Tools.hh(o,t,n,r,e[l+9],4,-640364487),r=MD5Tools.hh(r,o,t,n,e[l+12],11,-421815835),n=MD5Tools.hh(n,r,o,t,e[l+15],16,530742520),t=MD5Tools.hh(t,n,r,o,e[l+2],23,-995338651),o=MD5Tools.ii(o,t,n,r,e[l+0],6,-198630844),r=MD5Tools.ii(r,o,t,n,e[l+7],10,1126891415),n=MD5Tools.ii(n,r,o,t,e[l+14],15,-1416354905),t=MD5Tools.ii(t,n,r,o,e[l+5],21,-57434055),o=MD5Tools.ii(o,t,n,r,e[l+12],6,1700485571),r=MD5Tools.ii(r,o,t,n,e[l+3],10,-1894986606),n=MD5Tools.ii(n,r,o,t,e[l+10],15,-1051523),t=MD5Tools.ii(t,n,r,o,e[l+1],21,-2054922799),o=MD5Tools.ii(o,t,n,r,e[l+8],6,1873313359),r=MD5Tools.ii(r,o,t,n,e[l+15],10,-30611744),n=MD5Tools.ii(n,r,o,t,e[l+6],15,-1560198380),t=MD5Tools.ii(t,n,r,o,e[l+13],21,1309151649),o=MD5Tools.ii(o,t,n,r,e[l+4],6,-145523070),r=MD5Tools.ii(r,o,t,n,e[l+11],10,-1120210379),n=MD5Tools.ii(n,r,o,t,e[l+2],15,718787259),t=MD5Tools.ii(t,n,r,o,e[l+9],21,-343485551),o=MD5Tools.add(o,s),t=MD5Tools.add(t,c),n=MD5Tools.add(n,i),r=MD5Tools.add(r,a);return MD5Tools.rhex(o)+MD5Tools.rhex(t)+MD5Tools.rhex(n)+MD5Tools.rhex(r)}):alert("Sorry, but your browser doesn't support websocket");