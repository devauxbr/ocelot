var ocelotController,OcelotPromiseFactory,MD5Tools,Subscriber=function(e){var o=ocelotServices.subscribe(e);return Object.defineProperty(o,"topic",{value:e,writable:!1}),delete o.constraint,o.unsubscribe=function(){return ocelotServices.unsubscribe(e)},o};OcelotPromiseFactory=function(){var e="MESSAGE",o="RESULT",t="FAULT",n="CONSTRAINT";return{createPromise:function(r,s,c,i,a){return function(r,s,c,i,a){function l(){if(h)if(h.type!==e){for(;f=T.shift();)f(h);switch(h.type){case o:for(;f=d.shift();)f(h.response);break;case n:for(;f=p.shift();)f(h.response);break;case t:for(u=h.response,console.error(u.classname+"("+u.message+")"),console.table(u.stacktrace);f=g.shift();)f(u)}}else M.forEach(function(e){e(h.response)})}var u,f,h=null,d=[],g=[],p=[],T=[],M=[],v={id:s,key:s,dataservice:r,operation:c,args:a,argNames:i,cacheIgnored:!1,t:(new Date).getTime(),set response(e){h=e,l()},ignoreCache:function(e){return this.cacheIgnored=e,this},then:function(e,o){return e&&d.push(e),o&&g.push(o),l(),this},"catch":function(e){return e&&g.push(e),l(),this},constraint:function(e){return e&&p.push(e),l(),this},event:function(e){return e&&T.push(e),l(),this},message:function(e){return e&&M.push(e),l(),this},get json(){return{id:this.id,ds:this.dataservice,op:this.operation,argNames:this.argNames,args:this.args}}},D=document.createEvent("Event");return D.initEvent("call",!0,!1),D.promise=v,setTimeout(function(){document.dispatchEvent(D)},1),v}(r,s,c,i,a)}}}(),document.addEventListener("call",function(e){ocelotController.addPromise(e.promise)}),window.addEventListener("beforeunload",function(e){ocelotController&&ocelotController.close()}),MD5Tools=function(){return{hex_chr:function(e){return"0123456789abcdef".charAt(e)},rhex:function(e){var o,t="";for(o=0;3>=o;o++)t+=this.hex_chr(e>>8*o+4&15)+this.hex_chr(e>>8*o&15);return t},str2blks_MD5:function(e){var o,t,n=(e.length+8>>6)+1;for(o=new Array(16*n),t=0;16*n>t;t++)o[t]=0;for(t=0;t<e.length;t++)o[t>>2]|=e.charCodeAt(t)<<t%4*8;return o[t>>2]|=128<<t%4*8,o[16*n-2]=8*e.length,o},add:function(e,o){var t,n;return t=(65535&e)+(65535&o),n=(e>>16)+(o>>16)+(t>>16),n<<16|65535&t},rol:function(e,o){return e<<o|e>>>32-o},cmn:function(e,o,t,n,r,s){return this.add(this.rol(this.add(this.add(o,e),this.add(n,s)),r),t)},ff:function(e,o,t,n,r,s,c){return this.cmn(o&t|~o&n,e,o,r,s,c)},gg:function(e,o,t,n,r,s,c){return this.cmn(o&n|t&~n,e,o,r,s,c)},hh:function(e,o,t,n,r,s,c){return this.cmn(o^t^n,e,o,r,s,c)},ii:function(e,o,t,n,r,s,c){return this.cmn(t^(o|~n),e,o,r,s,c)}}}(),String.prototype.md5=function(){var e,o,t,n,r,s,c,i,a,l;for(e=MD5Tools.str2blks_MD5(this),o=1732584193,t=-271733879,n=-1732584194,r=271733878,l=0;l<e.length;l+=16)s=o,c=t,i=n,a=r,o=MD5Tools.ff(o,t,n,r,e[l+0],7,-680876936),r=MD5Tools.ff(r,o,t,n,e[l+1],12,-389564586),n=MD5Tools.ff(n,r,o,t,e[l+2],17,606105819),t=MD5Tools.ff(t,n,r,o,e[l+3],22,-1044525330),o=MD5Tools.ff(o,t,n,r,e[l+4],7,-176418897),r=MD5Tools.ff(r,o,t,n,e[l+5],12,1200080426),n=MD5Tools.ff(n,r,o,t,e[l+6],17,-1473231341),t=MD5Tools.ff(t,n,r,o,e[l+7],22,-45705983),o=MD5Tools.ff(o,t,n,r,e[l+8],7,1770035416),r=MD5Tools.ff(r,o,t,n,e[l+9],12,-1958414417),n=MD5Tools.ff(n,r,o,t,e[l+10],17,-42063),t=MD5Tools.ff(t,n,r,o,e[l+11],22,-1990404162),o=MD5Tools.ff(o,t,n,r,e[l+12],7,1804603682),r=MD5Tools.ff(r,o,t,n,e[l+13],12,-40341101),n=MD5Tools.ff(n,r,o,t,e[l+14],17,-1502002290),t=MD5Tools.ff(t,n,r,o,e[l+15],22,1236535329),o=MD5Tools.gg(o,t,n,r,e[l+1],5,-165796510),r=MD5Tools.gg(r,o,t,n,e[l+6],9,-1069501632),n=MD5Tools.gg(n,r,o,t,e[l+11],14,643717713),t=MD5Tools.gg(t,n,r,o,e[l+0],20,-373897302),o=MD5Tools.gg(o,t,n,r,e[l+5],5,-701558691),r=MD5Tools.gg(r,o,t,n,e[l+10],9,38016083),n=MD5Tools.gg(n,r,o,t,e[l+15],14,-660478335),t=MD5Tools.gg(t,n,r,o,e[l+4],20,-405537848),o=MD5Tools.gg(o,t,n,r,e[l+9],5,568446438),r=MD5Tools.gg(r,o,t,n,e[l+14],9,-1019803690),n=MD5Tools.gg(n,r,o,t,e[l+3],14,-187363961),t=MD5Tools.gg(t,n,r,o,e[l+8],20,1163531501),o=MD5Tools.gg(o,t,n,r,e[l+13],5,-1444681467),r=MD5Tools.gg(r,o,t,n,e[l+2],9,-51403784),n=MD5Tools.gg(n,r,o,t,e[l+7],14,1735328473),t=MD5Tools.gg(t,n,r,o,e[l+12],20,-1926607734),o=MD5Tools.hh(o,t,n,r,e[l+5],4,-378558),r=MD5Tools.hh(r,o,t,n,e[l+8],11,-2022574463),n=MD5Tools.hh(n,r,o,t,e[l+11],16,1839030562),t=MD5Tools.hh(t,n,r,o,e[l+14],23,-35309556),o=MD5Tools.hh(o,t,n,r,e[l+1],4,-1530992060),r=MD5Tools.hh(r,o,t,n,e[l+4],11,1272893353),n=MD5Tools.hh(n,r,o,t,e[l+7],16,-155497632),t=MD5Tools.hh(t,n,r,o,e[l+10],23,-1094730640),o=MD5Tools.hh(o,t,n,r,e[l+13],4,681279174),r=MD5Tools.hh(r,o,t,n,e[l+0],11,-358537222),n=MD5Tools.hh(n,r,o,t,e[l+3],16,-722521979),t=MD5Tools.hh(t,n,r,o,e[l+6],23,76029189),o=MD5Tools.hh(o,t,n,r,e[l+9],4,-640364487),r=MD5Tools.hh(r,o,t,n,e[l+12],11,-421815835),n=MD5Tools.hh(n,r,o,t,e[l+15],16,530742520),t=MD5Tools.hh(t,n,r,o,e[l+2],23,-995338651),o=MD5Tools.ii(o,t,n,r,e[l+0],6,-198630844),r=MD5Tools.ii(r,o,t,n,e[l+7],10,1126891415),n=MD5Tools.ii(n,r,o,t,e[l+14],15,-1416354905),t=MD5Tools.ii(t,n,r,o,e[l+5],21,-57434055),o=MD5Tools.ii(o,t,n,r,e[l+12],6,1700485571),r=MD5Tools.ii(r,o,t,n,e[l+3],10,-1894986606),n=MD5Tools.ii(n,r,o,t,e[l+10],15,-1051523),t=MD5Tools.ii(t,n,r,o,e[l+1],21,-2054922799),o=MD5Tools.ii(o,t,n,r,e[l+8],6,1873313359),r=MD5Tools.ii(r,o,t,n,e[l+15],10,-30611744),n=MD5Tools.ii(n,r,o,t,e[l+6],15,-1560198380),t=MD5Tools.ii(t,n,r,o,e[l+13],21,1309151649),o=MD5Tools.ii(o,t,n,r,e[l+4],6,-145523070),r=MD5Tools.ii(r,o,t,n,e[l+11],10,-1120210379),n=MD5Tools.ii(n,r,o,t,e[l+2],15,718787259),t=MD5Tools.ii(t,n,r,o,e[l+9],21,-343485551),o=MD5Tools.add(o,s),t=MD5Tools.add(t,c),n=MD5Tools.add(n,i),r=MD5Tools.add(r,a);return MD5Tools.rhex(o)+MD5Tools.rhex(t)+MD5Tools.rhex(n)+MD5Tools.rhex(r)},"WebSocket"in window?ocelotController=function(){function e(e,o,t){var n=document.createEvent(J);return n.initEvent(e,!0,!1),n.dataservice=o.dataservice,n.operation=o.operation,n.args=o.args,n.totaltime=0,n.javatime=0,n.jstime=0,n.networktime=0,t&&(n.response=t.response,w.monitor&&(n.javatime=t.t)),w.monitor&&(n.totaltime=(new Date).getTime()-o.t),n}function o(o,t){return e(L,o,t)}function t(o,t){return e(j,o,t)}function n(o,t){return e(k,o,t)}function r(o,t){return e(R,o,t)}function s(){c(_,function(e){var t=o(e,{response:ocelotController.status,t:0});e.response=t})}function c(e,o){i(u(e),o)}function i(e,o){var t;if(e)for(t=0;t<e.length;t++)o(e[t])}function a(e,o){var t=void 0!==H[o];return t||(H[o]=[]),H[o].push(e),t}function l(e){delete H[e]}function u(e){return H[e]||[]}function f(e){return e&&"ocelotController"===e.dataservice}function h(e){return e.dataservice===q&&e.operation===W}function d(e,o){return h(e)&&T(e,o)}function g(e){return e.dataservice===q&&e.operation===F}function p(e,o){return g(e)&&T(e,o)}function T(e,o){return o?e.args[0]===o:!0}function M(e){var o=e.split("&");o.forEach(function(e){if(0===e.search(/^\??ocelot=/)){var o=decodeURI(e.replace(/\??ocelot=/,""));w=JSON.parse(o)}})}function v(e){var o,t,n;a(e,e.id)||(t=JSON.stringify(e.json),n=new XMLHttpRequest,n.onreadystatechange=function(){4===n.readyState&&(200===n.status?(o=JSON.parse(n.responseText),D(o)):D({id:e.id,type:R,response:{classname:"XMLHttpRequest",message:"XMLHttpRequest request failed : code = "+n.status,stacktrace:[]},t:0}))},n.open("POST","http"+I+"ocelot/endpoint",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("mfc="+t))}function D(e){e.type===j&&ocelotController.cacheManager.putResultInCache(e),c(e.id,function(s){switch(e.type){case R:s.response=r(s,e);break;case j:d(s)?a(s,s.args[0]):p(s)&&l(s.args[0]),s.response=t(s,e);break;case k:s.response=n(s,e);break;case L:s.response=o(s,e)}}),e.type!==L&&l(e.id)}function m(e){D(JSON.parse(e.data))}function S(e){console.info("Websocket error : "+e.reason),s()}function b(e){s(),console.info("Websocket closed : "+e.reason+" try reconnect each 1000ms"),O=setInterval(function(){E()},1e3)}function C(e){clearInterval(O),console.info("Websocket opened");var o;s(),o=H,H={},Object.keys(o).forEach(function(e){e!==o[e].id&&i(o[e],ocelotController.addPromise)})}function E(){console.info("Ocelotds initialization...");for(var e=/ocelot-core.js|ocelot\.js.*|ocelot\/core(\.min)?\.js/,o=0;o<document.scripts.length;o++){var t=document.scripts[o];t.src.match(e)&&(I=t.src.replace(/^http/,"").replace(e,""))}return M(document.location.search),ocelotServices.initCore(w).then(function(){N=new WebSocket("ws"+I+"ocelot-endpoint"),N.onmessage=m,N.onopen=C,N.onerror=S,N.onclose=b})}function y(){E().then(function(){ocelotServices.subscribe(P).message(function(e){e===x?ocelotController.cacheManager.clearCache():ocelotController.cacheManager.removeEntryInCache(e)}),ocelotServices.getLocale().then(function(e){e&&ocelotServices.setLocale(e)}),ocelotServices.getOutDatedCache(ocelotController.cacheManager.getLastUpdateCache()).then(function(e){ocelotController.cacheManager.removeEntries(e)})})}var O,I,N,w={monitor:!1,debug:!1},L="MESSAGE",k="CONSTRAINT",j="RESULT",R="FAULT",x="ALL",J="Event",U="add",A="remove",P="ocelot-cleancache",_="ocelot-status",q="org.ocelotds.OcelotServices",W="subscribe",F="unsubscribe",G=["CONNECTING","OPEN","CLOSING","CLOSED"],H={};return y(),{get options(){return w},get status(){return N?G[N.readyState]:"CLOSED"},close:function(e){setTimeout(function(){N.close(1e3,"Normal closure; the connection successfully completed whatever purpose for which it was created."|e)},10)},addPromise:function(e){if(d(e,_))return a(e,_),void s();if(p(e,_))return void l(_);if(f(e))return void a(e,e.id);var o=ocelotController.cacheManager.getResultInCache(e.id,e.cacheIgnored);return o?void(e.response=t(e,{response:o.response,t:0})):void v(e)},cacheManager:function(){function e(e){var o=document.createEvent(J);o.initEvent(U,!0,!1),o.msg=e,r.forEach(function(e){e(o)})}function o(e){var o=document.createEvent(J);o.initEvent(A,!0,!1),o.key=e,s.forEach(function(e){e(o)})}var t,n="ocelot-lastupdate",r=[],s=[];return t={addEntry:function(e){var o=this.getLastUpdateCache();o[e]=Date.now(),localStorage.setItem(n,JSON.stringify(o))},removeEntry:function(e){var o=this.getLastUpdateCache();delete o[e],localStorage.setItem(n,JSON.stringify(o))},getLastUpdateCache:function(){var e=localStorage.getItem(n);return e=e?JSON.parse(e):{}}},{getLastUpdateCache:function(){return t.getLastUpdateCache()},addEventListener:function(e,o){e===U?r.push(o):e===A&&s.push(o)},removeEventListener:function(e,o){var t=-1;e===U?(t=r.indexOf(o),-1!==t&&r.splice(t,1)):e===A&&(t=s.indexOf(o),-1!==t&&s.splice(t,1))},putResultInCache:function(o){var n,r,s;o.deadline&&(t.addEntry(o.id),e(o),n=o.id.split("_"),r=localStorage.getItem(n[0]),s={},r&&(s=JSON.parse(r)),s[n[1]]=o,r=JSON.stringify(s),localStorage.setItem(n[0],r))},getResultInCache:function(e,o){var t,n,r,s,c;return o?null:(t=e.split("_"),r=null,n=localStorage.getItem(t[0]),n&&(s=JSON.parse(n),r=s[t[1]]),r&&(c=(new Date).getTime(),c>r.deadline&&(this.removeEntryInCache(e),r=null)),r)},removeEntryInCache:function(e){var n,r,s;t.removeEntry(e),o(e),n=e.split("_"),r=localStorage.getItem(n[0]),r&&(s=JSON.parse(r),2===n.length?(delete s[n[1]],localStorage.setItem(n[0],JSON.stringify(s))):localStorage.removeItem(n[0]))},removeEntries:function(e){e.forEach(function(e){removeEntryInCache(e)})},clearCache:function(){localStorage.clear()}}}()}}():alert("Sorry, but your browser doesn't support websocket");