<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
	<head>
		<title>Page de test</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body>
		<script src="ocelot.js" type="text/javascript"></script>
		<script src="demo.js" type="text/javascript"></script>
		<script>
			var mdb = new Mdb("mytopic");
			mdb.onMessage = function (msg) {
				addMessage(msg);
			};
			var testService = new TestService();
			function getMessage() {
				var token = testService.getMessage(Math.floor(Math.random()*10));
				token.onResult = function (msg) {
					addMessage(msg);
				};
				token.onFault = function (fault) {
					alert(fault.message + "\n" + fault.classname + "\n" + fault.stacktrace.join('\n'));
				};
			};
			function getFault() {
				var token = testService.getFault(5);
				token.onResult = function (msg) {
					addMessage(msg);
				};
				token.onFault = function (fault) {
					alert(fault.message + "\n" + fault.classname + "\n" + fault.stacktrace.join('\n'));
				};
			};
			
			function addMessage(msg) {
				var output = document.getElementById("output");
				var pre = document.createElement("p");
				pre.style.wordWrap = "break-word";
				pre.innerHTML = msg;
				output.appendChild(pre);
			}
			
			function showObject() {
				var obj = eval(document.getElementById("testobject").value);
				document.getElementById("objectarea").textContent = JSON.stringify(obj).replace(/,/g, "\n");
			}
		</script>
		<input id="testobject" type="text" value="document.location"/>
		<button onclick="showObject()">SHOW OBJECT</button><br>
		<textarea style="height:200px;width:100%" id="objectarea"></textarea><br>
		<button onclick="mdb.subscribe();">SUBSCRIBE</button>
		<button onclick="mdb.unsubscribe();">UNSUBSCRIBE</button>
		<button onclick="getMessage()">GET MESSAGE</button>
		<button onclick="getFault()">GET FAULT</button>
		<div id="output"></div>
	</body>
</html>
